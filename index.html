<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JERCAT Pro Trading Bot - Real DEX Swaps</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüê±%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --border: #374151;
            --glass-bg: rgba(17, 24, 39, 0.6);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.06) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.06) 0%, transparent 50%);
            z-index: 0;
            animation: bgFloat 20s ease infinite;
        }

        @keyframes bgFloat {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.7; }
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .fix-badge {
            display: inline-block;
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .top-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .card-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -10px var(--accent-blue);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }

        .stat-value.green {
            color: var(--accent-green);
        }

        .stat-value.red {
            color: var(--accent-red);
        }

        .stat-value.blue {
            color: var(--accent-blue);
        }

        .log-container {
            max-height: 400px;
            overflow-y: auto;
            background: var(--bg-tertiary);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .log-entry {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .log-entry.info {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--accent-blue);
        }

        .log-entry.success {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--accent-green);
        }

        .log-entry.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid var(--accent-yellow);
        }

        .log-entry.error {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--accent-red);
        }

        .log-time {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .wallet-info {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }

        .wallet-address {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: var(--accent-blue);
            word-break: break-all;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-indicator.online {
            background: var(--accent-green);
            box-shadow: 0 0 8px var(--accent-green);
        }

        .status-indicator.offline {
            background: var(--text-muted);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--accent-yellow);
            color: var(--accent-yellow);
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üê± JERCAT Pro Trading Bot</h1>
            <p class="header-subtitle">
                Real DEX Trading with PancakeSwap Integration
                <span class="fix-badge">üî• VRAIS SWAPS CRYPTO</span>
            </p>
        </div>

        <!-- Alerts -->
        <div class="alert alert-warning">
            ‚ö†Ô∏è <strong>ATTENTION:</strong> Ce bot effectue de VRAIES transactions sur PancakeSwap. Assurez-vous d'avoir des USDT et BNB pour le gas dans votre wallet BSC.
        </div>

        <div class="alert alert-info">
            ‚ÑπÔ∏è <strong>Comment √ßa marche:</strong> Le bot swap vos USDT contre BNB quand il d√©tecte un signal d'achat, puis swap BNB contre USDT pour vendre. Vous devez approuver chaque transaction dans MetaMask.
        </div>

        <!-- Top Bar - Wallet & Stats -->
        <div class="top-bar">
            <!-- Wallet Connection -->
            <div class="card">
                <div class="card-header">
                    <h2>üîó Wallet BSC</h2>
                    <span class="status-indicator" id="statusIndicator"></span>
                </div>
                <button class="btn btn-primary" id="connectWalletBtn" style="width: 100%;">
                    üîó Connecter MetaMask
                </button>
                <button class="btn btn-danger" id="disconnectWalletBtn" style="width: 100%; display: none;">
                    üîå D√©connecter
                </button>
                <div class="wallet-info" id="walletInfo" style="display: none;">
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Adresse:</strong>
                        <div class="wallet-address" id="walletAddress"></div>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <strong>BNB:</strong>
                        <span id="bnbBalance">0</span> BNB
                    </div>
                    <div>
                        <strong>USDT:</strong>
                        <span id="usdtBalance">0</span> USDT
                    </div>
                </div>
            </div>

            <!-- Global Stats -->
            <div class="card">
                <div class="card-header">
                    <h2>üìä Statistiques</h2>
                </div>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total P&L</div>
                        <div class="stat-value" id="totalProfitLoss">$0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Prix BNB</div>
                        <div class="stat-value blue" id="bnbPrice">$0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Trades</div>
                        <div class="stat-value blue" id="totalTrades">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Position</div>
                        <div class="stat-value" id="currentPosition">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Left Column - Controls -->
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <!-- Trading Controls -->
                <div class="card">
                    <div class="card-header">
                        <h2>‚öôÔ∏è Configuration Trading</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Montant par Trade (USDT)</label>
                        <input type="number" class="form-input" id="tradeAmount" value="10" min="5" step="1">
                        <small style="color: var(--text-muted); font-size: 0.75rem;">
                            Minimum recommand√©: 10 USDT (√† cause des frais de gas)
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Take Profit (%)</label>
                        <input type="number" class="form-input" id="takeProfitPercent" value="3" min="0.5" step="0.5">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Stop Loss (%)</label>
                        <input type="number" class="form-input" id="stopLossPercent" value="2" min="0.5" step="0.5">
                    </div>

                    <div class="grid-2">
                        <button class="btn btn-success" id="startBotBtn">
                            ‚ñ∂Ô∏è D√©marrer Bot
                        </button>
                        <button class="btn btn-danger" id="stopBotBtn" style="display: none;">
                            ‚è∏Ô∏è Arr√™ter Bot
                        </button>
                    </div>

                    <div class="grid-2" style="margin-top: 1rem;">
                        <button class="btn btn-primary" id="manualBuyBtn">
                            üìà Acheter BNB
                        </button>
                        <button class="btn btn-danger" id="manualSellBtn">
                            üìâ Vendre BNB
                        </button>
                    </div>
                </div>

                <!-- Approval Section -->
                <div class="card">
                    <div class="card-header">
                        <h2>üîì Approbations DEX</h2>
                    </div>
                    <p style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 1rem;">
                        Avant de trader, vous devez approuver PancakeSwap √† utiliser vos tokens.
                    </p>
                    <button class="btn btn-primary" id="approveUsdtBtn" style="width: 100%; margin-bottom: 0.5rem;">
                        ‚úÖ Approuver USDT
                    </button>
                    <div id="approvalStatus" style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;"></div>
                </div>
            </div>

            <!-- Right Column - Logs -->
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <!-- Activity Log -->
                <div class="card" style="flex: 1;">
                    <div class="card-header">
                        <h2>üìù Journal d'Activit√©</h2>
                        <button class="btn" onclick="clearLogs()" style="padding: 0.5rem 1rem; background: var(--bg-tertiary);">
                            üóëÔ∏è Effacer
                        </button>
                    </div>
                    <div class="log-container" id="logContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const CONFIG = {
            // BSC Mainnet
            CHAIN_ID: '0x38',
            RPC_URL: 'https://bsc-dataseed.binance.org/',
            
            // PancakeSwap V2 Router
            PANCAKE_ROUTER: '0x10ED43C718714eb63d5aA57B78B54704E256024E',
            
            // Token addresses
            WBNB: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',
            USDT: '0x55d398326f99059fF775485246999027B3197955',
            
            // Developer wallet for commission
            DEVELOPER_WALLET: '0xb44dd82c004a767d23b890f788fd6f9b13fcf6a4',
            COMMISSION_RATE: 0.001, // 0.1%
            
            // Binance API for price
            BINANCE_API: 'https://api.binance.com/api/v3',
            
            // Trading settings
            UPDATE_INTERVAL: 60000, // 1 minute
            SLIPPAGE: 1, // 1%
            GAS_LIMIT: 300000
        };

        // PancakeSwap Router ABI (simplified)
        const ROUTER_ABI = [
            {
                "inputs": [
                    {"internalType": "uint256", "name": "amountIn", "type": "uint256"},
                    {"internalType": "uint256", "name": "amountOutMin", "type": "uint256"},
                    {"internalType": "address[]", "name": "path", "type": "address[]"},
                    {"internalType": "address", "name": "to", "type": "address"},
                    {"internalType": "uint256", "name": "deadline", "type": "uint256"}
                ],
                "name": "swapExactTokensForTokens",
                "outputs": [{"internalType": "uint256[]", "name": "amounts", "type": "uint256[]"}],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "amountIn", "type": "uint256"},
                    {"internalType": "address[]", "name": "path", "type": "address[]"}
                ],
                "name": "getAmountsOut",
                "outputs": [{"internalType": "uint256[]", "name": "amounts", "type": "uint256[]"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // ERC20 Token ABI (simplified)
        const ERC20_ABI = [
            {
                "constant": true,
                "inputs": [{"name": "_owner", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "balance", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {"name": "_spender", "type": "address"},
                    {"name": "_value", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [
                    {"name": "_owner", "type": "address"},
                    {"name": "_spender", "type": "address"}
                ],
                "name": "allowance",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            }
        ];

        // ===== STATE =====
        const state = {
            web3: null,
            account: null,
            bnbBalance: 0,
            usdtBalance: 0,
            isConnected: false,
            isBotActive: false,
            currentPrice: 0,
            openPosition: null,
            trades: [],
            updateInterval: null,
            routerContract: null,
            usdtContract: null,
            isApproved: false
        };

        // ===== WALLET CONNECTION =====
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('MetaMask non d√©tect√©! Installez MetaMask pour continuer.');
                window.open('https://metamask.io/download/', '_blank');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                state.account = accounts[0];
                state.web3 = new Web3(window.ethereum);

                // Check if on BSC
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                
                if (chainId !== CONFIG.CHAIN_ID) {
                    addLog('warning', '‚ö†Ô∏è Mauvais r√©seau! Changement vers BSC Mainnet...');
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: CONFIG.CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: CONFIG.CHAIN_ID,
                                    chainName: 'BSC Mainnet',
                                    nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
                                    rpcUrls: ['https://bsc-dataseed.binance.org/'],
                                    blockExplorerUrls: ['https://bscscan.com']
                                }]
                            });
                        }
                    }
                }

                // Initialize contracts
                state.routerContract = new state.web3.eth.Contract(ROUTER_ABI, CONFIG.PANCAKE_ROUTER);
                state.usdtContract = new state.web3.eth.Contract(ERC20_ABI, CONFIG.USDT);

                // Get balances
                await updateBalances();

                state.isConnected = true;

                // Update UI
                document.getElementById('connectWalletBtn').style.display = 'none';
                document.getElementById('disconnectWalletBtn').style.display = 'block';
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('walletAddress').textContent = state.account;
                document.getElementById('statusIndicator').className = 'status-indicator online';

                addLog('success', `‚úÖ Wallet connect√©: ${state.account.substring(0, 6)}...${state.account.substring(38)}`);
                addLog('info', `üåê R√©seau: BSC Mainnet`);
                addLog('info', `üí∞ BNB: ${state.bnbBalance.toFixed(4)}, USDT: ${state.usdtBalance.toFixed(2)}`);

                // Check approval
                await checkApproval();

            } catch (error) {
                console.error('Error connecting wallet:', error);
                addLog('error', 'Erreur connexion: ' + error.message);
            }
        }

        async function updateBalances() {
            try {
                // Get BNB balance
                const bnbWei = await state.web3.eth.getBalance(state.account);
                state.bnbBalance = parseFloat(state.web3.utils.fromWei(bnbWei, 'ether'));
                
                // Get USDT balance
                const usdtWei = await state.usdtContract.methods.balanceOf(state.account).call();
                state.usdtBalance = parseFloat(state.web3.utils.fromWei(usdtWei, 'ether'));

                document.getElementById('bnbBalance').textContent = state.bnbBalance.toFixed(4);
                document.getElementById('usdtBalance').textContent = state.usdtBalance.toFixed(2);
            } catch (error) {
                console.error('Error updating balances:', error);
            }
        }

        function disconnectWallet() {
            state.isConnected = false;
            state.account = null;

            if (state.isBotActive) {
                stopBot();
            }

            document.getElementById('connectWalletBtn').style.display = 'block';
            document.getElementById('disconnectWalletBtn').style.display = 'none';
            document.getElementById('walletInfo').style.display = 'none';
            document.getElementById('statusIndicator').className = 'status-indicator offline';

            addLog('warning', 'üîå Wallet d√©connect√©');
        }

        // ===== APPROVAL =====
        async function checkApproval() {
            try {
                const allowance = await state.usdtContract.methods
                    .allowance(state.account, CONFIG.PANCAKE_ROUTER)
                    .call();
                
                const allowanceAmount = parseFloat(state.web3.utils.fromWei(allowance, 'ether'));
                
                state.isApproved = allowanceAmount > 1000;
                
                if (state.isApproved) {
                    document.getElementById('approvalStatus').textContent = '‚úÖ USDT approuv√© pour PancakeSwap';
                    document.getElementById('approvalStatus').style.color = 'var(--accent-green)';
                } else {
                    document.getElementById('approvalStatus').textContent = '‚ùå USDT non approuv√©';
                    document.getElementById('approvalStatus').style.color = 'var(--accent-red)';
                }
            } catch (error) {
                console.error('Error checking approval:', error);
            }
        }

        async function approveUsdt() {
            if (!state.isConnected) {
                alert('Connectez votre wallet d\'abord!');
                return;
            }

            try {
                addLog('info', 'üîì Demande d\'approbation USDT...');
                
                // Approve max amount
                const maxAmount = '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';
                
                await state.usdtContract.methods
                    .approve(CONFIG.PANCAKE_ROUTER, maxAmount)
                    .send({ from: state.account });
                
                state.isApproved = true;
                addLog('success', '‚úÖ USDT approuv√© pour PancakeSwap!');
                
                await checkApproval();
            } catch (error) {
                console.error('Error approving USDT:', error);
                addLog('error', 'Erreur approbation: ' + error.message);
            }
        }

        // ===== PRICE DATA =====
        async function fetchBnbPrice() {
            try {
                const response = await fetch(`${CONFIG.BINANCE_API}/ticker/price?symbol=BNBUSDT`);
                const data = await response.json();
                state.currentPrice = parseFloat(data.price);
                
                document.getElementById('bnbPrice').textContent = '$' + state.currentPrice.toFixed(2);
                
                return state.currentPrice;
            } catch (error) {
                console.error('Error fetching price:', error);
                return null;
