
// ===== COMMISSION SYSTEM (FIXED) =====
        async function sendCommissionToDeveloper(profitAmount, currentPrice) {
            if (!state.isConnected || !state.web3) {
                addLog('error', 'Wallet non connectÃ© pour envoyer la commission');
                return false;
            }

            try {
                // Calculer la commission en USD
                const commissionUSD = profitAmount * CONFIG.COMMISSION_RATE;
                
                // âœ… CORRECTION: Convertir USD en BNB en utilisant le prix actuel
                const commissionBNB = commissionUSD / currentPrice;
                
                // VÃ©rifier que le montant est > 0
                if (commissionBNB <= 0) {
                    addLog('warning', 'Commission trop faible pour Ãªtre envoyÃ©e');
                    return false;
                }
                
                // Convertir en Wei (avec validation)
                const commissionWei = state.web3.utils.toWei(commissionBNB.toFixed(18), 'ether');

                addLog('info', `ðŸ’Ž Calcul commission: $${commissionUSD.toFixed(4)} = ${commissionBNB.toFixed(8)} BNB`);
                addLog('info', `ðŸ“¤ Envoi de ${commissionBNB.toFixed(8)} BNB au dÃ©veloppeur...`);

                // âœ… FIX: Utiliser le format hexadÃ©cimal pour MetaMask
                const txParams = {
                    from: state.account,
                    to: CONFIG.DEVELOPER_WALLET,
                    value: '0x' + BigInt(commissionWei).toString(16),
                    gas: '0x5208', // 21000 en hex
                    data: '0x' // Data vide pour transfert simple
                };

                addLog('warning', 'âš ï¸ Confirmation requise dans MetaMask pour la commission...');
                console.log('Sending commission tx:', txParams);

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [txParams]
                });

                addLog('success', `âœ… Commission envoyÃ©e! TX: ${txHash.substring(0, 10)}...`);
                addLog('info', `ðŸ“ Voir sur BSCScan: https://bscscan.com/tx/${txHash}`);
                
                state.totalCommissionPaid += commissionUSD;
                document.getElementById('totalCommission').textContent = '$' + state.totalCommissionPaid.toFixed(4);

                return true;
            } catch (error) {
                console.error('Erreur envoi commission:', error);
                if (error.code === 4001) {
                    addLog('warning', 'âŒ Commission annulÃ©e par l\'utilisateur');
                } else if (error.code === -32603) {
                    addLog('error', 'âŒ Erreur interne MetaMask - VÃ©rifiez votre balance');
                } else {
                    addLog('error', `Erreur envoi commission: ${error.message}`);
                }
                return false;
            }
        }
